<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <script>


            var personajes = [
                //Pos 0 = columna
                //Pos 1 = fila
                //Pos 3 direccion
                //0=Izquierda 1=Arriba 2=Derecha 3=Abajo
                //Pos 4 = en que direccion quiere ir (Jugador)
                [0, 0, 0, 0], //Jugador
                [0, 0, 0], //Fantasma 1
                [0, 0, 0], //Fantasma 2
                [0, 0, 0], //Fantasma 3
                [0, 0, 0] //Fantasma 4
            ];
            var tablero = [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1],
                [1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1],
                [1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1],
                [1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1],
                [1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1],
                [1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1],
                [1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1],
                [1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1],
                [1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1],
                [1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]];
            function pinta() {
                document.body.innerHTML = ""; //Limpia el cuerpo de la pagina
                for (var y = 0; y < tablero.length; y++) {
                    for (var x = 0; x < tablero[y].length; x++) {
                        if (tablero[y][x] == 1 && x != tablero[y].length - 1) {
                            document.write("X");
                        } else if (tablero[y][x] == 0) {
                            document.write("Y");
                        } else if (tablero[y][x] == 2) {
                            document.write("K"); //Fantasma
                        } else if (tablero[y][x] == 3) {
                            document.write("G"); //Jugador
                        } else {
                            document.write("X<br>");
                        }
                    }
                }
            }
            function direccion(y, x) {
                var dir = [];
                if (tablero[y][x - 1] == 0) {
                    dir.push(0);
                }
                if (tablero[y + 1][x] == 0) {
                    dir.push(1);
                }
                if (tablero[y][x + 1] == 0) {
                    dir.push(2);
                }
                if (tablero[y - 1][x] == 0) {
                    dir.push(3);
                }
                return dir[Math.floor((Math.random() * dir.length))];
            }

            function direccionCruces(y, x, n) {
                var dir = [];
                if (tablero[y][x - 1] != 1 && n != 2) {
                    dir.push(0);
                }
                if (tablero[y + 1][x] != 1 && n != 3) {
                    dir.push(1);
                }
                if (tablero[y][x + 1] != 1 && n != 0) {
                    dir.push(2);
                }
                if (tablero[y - 1][x] != 1 && n != 1) {
                    dir.push(3);
                }
                return dir[Math.floor((Math.random() * dir.length))];
            }


            function posJPersonajes() {
                var i = 0;
                do {
                    var y = Math.floor((Math.random() * 28) + 1);
                    var x = Math.floor((Math.random() * 28) + 1);
                    if (tablero[y][x] === 0) {
                        //0=Izquierda 1=Arriba 2=Derecha 3=Abajo
                        personajes[i][0] = y;
                        personajes[i][1] = x;
                        personajes[i][2] = direccion(y, x);
                        i++;
                    }
                } while (i < personajes.length);
            }

            function mueve() {
                //Editar
                for (var y = 0; y < personajes.length; y++) {
                    var tipo;
                    if (y > 0) {
                        tipo = 2; //Fantasma
                    } else {
                        tipo = 3; //Jugador
                    }
                    
                    if (personajes[y][2] == 0 && tablero[personajes[y][0]][personajes[y][1] - 1] != 1) {
                        tablero[personajes[y][0]][personajes[y][1]] = 0;
                        tablero[personajes[y][0]][personajes[y][1] - 1] = tipo;
                        personajes[y][1] = personajes[y][1] - 1;
                        personajes[y][2] = direccionCruces(personajes[y][0], personajes[y][1], personajes[y][2]);

                    } else if (personajes[y][2] == 1 && tablero[personajes[y][0] + 1][personajes[y][1]] != 1) {
                        tablero[personajes[y][0]][personajes[y][1]] = 0;
                        tablero[personajes[y][0] + 1][personajes[y][1]] = tipo;
                        personajes[y][0] = personajes[y][0] + 1;
                        personajes[y][2] = direccionCruces(personajes[y][0], personajes[y][1], personajes[y][2]);

                    } else if (personajes[y][2] == 2 && tablero[personajes[y][0]][personajes[y][1] + 1] != 1) {
                        tablero[personajes[y][0]][personajes[y][1]] = 0;
                        tablero[personajes[y][0]][personajes[y][1] + 1] = tipo;
                        personajes[y][1] = personajes[y][1] + 1;
                        personajes[y][2] = direccionCruces(personajes[y][0], personajes[y][1], personajes[y][2]);

                    } else if (personajes[y][2] == 3 && tablero[personajes[y][0] - 1][personajes[y][1]] != 1) {
                        tablero[personajes[y][0]][personajes[y][1]] = 0;
                        tablero[personajes[y][0] - 1][personajes[y][1]] = tipo;
                        personajes[y][0] = personajes[y][0] - 1;
                        personajes[y][2] = direccionCruces(personajes[y][0], personajes[y][1], personajes[y][2]);

                    } else {
                        personajes[y][2] = direccion(personajes[y][0], personajes[y][1]);
                    }
                }
            }

            function choca() {
                for (var y = 1; y < personajes.length; y++) {
                    if (personajes[0][0] == personajes[y][0] && personajes[0][1] == personajes[y][1]) {
                        alert("Eliminado");
                    }
                }
            }

            posJPersonajes();
            setInterval(function () {
                mueve();
                choca();
                pinta();
            }, 100);

        </script>
    </body>
</html>


